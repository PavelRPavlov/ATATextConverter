@using ATAFurniture.Server.Models
@using Kroiko.Domain
@using Radzen
@using Radzen.Blazor
@using ATAFurniture.Server.DataAccess

@if (!_isContactInfoComplete)
{
    <RadzenAlert AlertStyle="AlertStyle.Warning" Variant="Variant.Filled">
        Потребителският профил няма пълна информация
    </RadzenAlert>
    <RadzenAlert AlertStyle="AlertStyle.Warning" Variant="Variant.Filled">
        Генерираните документи няма да съдържат контакти
    </RadzenAlert>
    <RadzenAlert AlertStyle="AlertStyle.Info" Variant="Variant.Outlined" Shade="Shade.Default">
        Може да въведете информацията в профилa си от <a href="MicrosoftIdentity/Account/EditProfile" class="btn btn-link">тук</a>
    </RadzenAlert>
    
    <RadzenTemplateForm TItem="ContactInfo" Data=@ConverterContext.ContactInfo>
        <RadzenFieldset Text="Временни контакти (няма да бъдат запазени)">
            <RadzenStack Gap="1rem">
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenLabel Text="Име на фирма"></RadzenLabel>
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="8">
                        <RadzenTextBox 
                            class="w-100"
                            style="display: block"
                            Name="CompanyName"
                            @bind-Value=@ConverterContext.ContactInfo.CompanyName/>
                        <RadzenRequiredValidator Component="CompanyName" Text="Полето е задължително" Style="position: relative"/>
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="4">
                        <RadzenLabel Text="Телефон за връзка"></RadzenLabel>
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="8">
                        <RadzenTextBox
                            class="w-100"
                            style="display: block"
                            Name="MobileNumber"
                            @bind-Value=@ConverterContext.ContactInfo.MobileNumber/>
                        <RadzenRequiredValidator Component="MobileNumber" Text="Полето е задължително" Style="position: relative"/>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenFieldset>
    </RadzenTemplateForm>
    <br/>
}
@code {
    [Inject] UserContextService UserContextService { get; set; }
    [CascadingParameter] ConverterContext ConverterContext { get; set; }
    bool _isContactInfoComplete;

    protected override void OnInitialized()
    {
        ConverterContext.ContactInfo.CompanyName = UserContextService.User.CompanyName;
        ConverterContext.ContactInfo.MobileNumber = UserContextService.User.MobileNumber;
        
        _isContactInfoComplete = !string.IsNullOrEmpty(ConverterContext.ContactInfo.CompanyName) &&
                                 !string.IsNullOrEmpty(ConverterContext.ContactInfo.MobileNumber);
    }
}